<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bet Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
/* ====== YOUR EXISTING CSS ‚Äî UNCHANGED ====== */
:root{
  --bg-main:#1c1f23;
  --bg-card:#262a30;
  --bg-soft:#2f343a;
  --bg-row:#343a40;

  --text-main:#ffffff;
  --text-muted:#9aa0a6;

  --row-h:40px;
  --gap:6px;

  --left-w:170px;
  --bet-w:104px;
  --summary-w:250px;

  --week-row-h:30px;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:Inter,system-ui,sans-serif;
  background:var(--bg-main);
  color:var(--text-main);
}

.app{
  height:100vh;
  display:grid;
  grid-template-rows:1fr auto;
}

@media (max-width: 768px){
  .app{
    transform: scale(0.78);
    transform-origin: top left;
    width: 128%;
    height: 128%;
  }
}

/* MAIN / LEFT / RIGHT / SUMMARY CSS unchanged ‚Ä¶ */

.rank-row{
  display:grid;
  grid-template-columns:20px 1fr auto;
  grid-template-rows:auto auto;
  gap:2px 6px;
  background:var(--bg-row);
  border-radius:10px;
  padding:8px;
  margin-bottom:6px;
}

.rank-row:last-child{margin-bottom:0}
.rank-pos{grid-row:span 2;font-weight:800}
.rank-name{font-weight:600;font-size:13px}
.rank-money{font-weight:800;color:#7CFF5B}
.rank-bets{grid-column:2/4;font-size:11px;opacity:.65}
</style>
</head>

<body>

<div class="app">
  <div class="main">
    <div class="left-card" id="left"></div>
    <div class="right-card"><div class="rows" id="right"></div></div>
  </div>

  <footer class="summary">
    <div class="summary-toggle open" id="summaryToggle"></div>

    <div class="summary-content" id="summaryContentWrap">
      <div class="weekly-card" id="weeklyCard"></div>

      <!-- üîÅ RANKING CARD (NOW DYNAMIC) -->
      <div class="ranking-card" id="rankingCard">
        <div class="ranking-title">üèÜ All-Time Ranking</div>
      </div>
    </div>
  </footer>
</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbyq9CTFOgnGo5Jp2hJ_MUqZhjWb0x99NfckqDV_nfZrO7dCvVlmrIek7LWtuXspjaE/exec";
const REFRESH_MS=30000;

const formatGBP=v=>"¬£"+Number(v??0).toFixed(2);
const formatEUR=v=>"‚Ç¨ "+Number(v??0).toFixed(2);

let prev={}, prevScore={};

function loadData(){
  fetch(API_URL).then(r=>r.json()).then(data=>{
    const left=document.getElementById("left");
    const right=document.getElementById("right");
    const weekly=document.getElementById("weeklyCard");
    const ranking=document.getElementById("rankingCard");

    left.innerHTML="";
    right.innerHTML="";
    weekly.innerHTML='<div class="weekly-title">üìä Weekly Summary</div>';
    ranking.innerHTML='<div class="ranking-title">üèÜ All-Time Ranking</div>';

    /* ===== EXISTING DASHBOARD BUILD (UNCHANGED) ===== */
    const lh=document.createElement("div");
    lh.className="left-header";
    lh.textContent="MATCHES";
    left.appendChild(lh);
    left.appendChild(document.createElement("div")).className="left-divider";

    const headerRow=document.createElement("div");
    headerRow.className="row";
    data.headers.forEach(h=>{
      const p=document.createElement("div");
      p.className="header-pill";
      p.textContent=h;
      headerRow.appendChild(p);
    });
    right.appendChild(headerRow);
    right.appendChild(document.createElement("div")).className="right-divider";

    data.matches.forEach((m,i)=>{
      const scoreKey=`score-${i}`;
      const lr=document.createElement("div");
      lr.className="left-row";
      lr.innerHTML=`
        <div class="left-cell match">${m.match}</div>
        <div class="left-cell">${m.status}</div>
        <div class="left-cell">${m.score}</div>
      `;
      left.appendChild(lr);

      const rr=document.createElement("div");
      rr.className="row";
      m.cells.forEach((c,j)=>{
        const el=document.createElement("div");
        el.className="bet";
        if(c.value){
          el.textContent=c.value;
          el.style.background=c.color;
        }
        rr.appendChild(el);
      });
      right.appendChild(rr);
    });

    /* ===== WEEKLY SUMMARY ===== */
    data.totals.forEach(t=>{
      const row=document.createElement("div");
      row.className="week-row";
      const forceGreen=["TOTAL WIN","TOTAL WIN PP","AVG. WIN"].includes(t.label);
      const isGreen=forceGreen || t.cells[0].color.toLowerCase().includes("green");

      row.innerHTML=`
        <div class="week-label">${t.label}</div>
        <div class="week-gbp ${isGreen?'green':'red'}">${formatGBP(t.cells[0].value)}</div>
        <div class="week-eur">${formatEUR(t.cells[1].value)}</div>
      `;
      weekly.appendChild(row);
    });

    /* ===== üÜï RANKING FROM SHEETS ===== */
    if (data.ranking && data.ranking.length) {
      data.ranking.forEach(r=>{
        const row=document.createElement("div");
        row.className="rank-row";
        row.innerHTML=`
          <div class="rank-pos">${r.rank}</div>
          <div class="rank-name">${r.name}</div>
          <div class="rank-money">¬£ ${Number(r.money).toFixed(2)}</div>
          <div class="rank-bets">${r.matchesRight} matches right</div>
        `;
        ranking.appendChild(row);
      });
    }
  });
}

loadData();
setInterval(loadData,REFRESH_MS);

const toggle=document.getElementById("summaryToggle");
toggle.onclick=()=>{
  document.getElementById("summaryContentWrap").classList.toggle("hidden");
  toggle.classList.toggle("open");
};
</script>

</body>
</html>
