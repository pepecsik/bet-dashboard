<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Bet Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
:root {
  --bg-main:#1f2125;
  --bg-panel:#26292e;
  --text-main:#e6e7ea;
  --text-muted:#9aa0a6;
  --row-h:46px;
  --gap:10px;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:Inter,system-ui,sans-serif;
  background:var(--bg-main);
  color:var(--text-main);
}

.sound-overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.8);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
}

.sound-box{
  background:var(--bg-panel);
  padding:26px 30px;
  border-radius:16px;
  text-align:center;
}

.sound-box h2{
  margin:0 0 10px;
  font-size:17px;
}

.sound-box button{
  margin-top:14px;
  padding:12px 18px;
  font-size:15px;
  font-weight:700;
  border-radius:12px;
  border:none;
  cursor:pointer;
}
</style>
</head>

<body>

<!-- ðŸ”” SOUND OVERLAY -->
<div class="sound-overlay" id="soundOverlay">
  <div class="sound-box">
    <h2>ðŸ”” Enable alerts</h2>
    <div>Get notified when bets change</div>

    <!-- âœ… INLINE CLICK â€” CAN NOT FAIL -->
    <button onclick="enableSoundAndClose()">Enable sound</button>
  </div>
</div>

<script>
/* ===== SOUND CORE ===== */
let audioCtx = null;
let alertBuffer = null;
let soundEnabled = false;

function enableSoundAndClose(){
  // 1ï¸âƒ£ Remove overlay immediately (no JS lookup, browser does it)
  document.getElementById("soundOverlay").style.display = "none";

  // 2ï¸âƒ£ Persist permission
  localStorage.setItem("soundEnabled","1");
  soundEnabled = true;

  // 3ï¸âƒ£ Init sound (still inside user gesture)
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  audioCtx.resume();

  fetch("https://assets.mixkit.co/sfx/preview/mixkit-warning-alarm-buzzer-991.mp3")
    .then(r => r.arrayBuffer())
    .then(b => audioCtx.decodeAudioData(b))
    .then(buf => alertBuffer = buf);
}

/* ===== PLAY ALERT ===== */
function playAlert(){
  if(!soundEnabled || !alertBuffer) return;
  const src = audioCtx.createBufferSource();
  src.buffer = alertBuffer;
  src.connect(audioCtx.destination);
  src.start();
}

/* ===== RESTORE STATE ===== */
if(localStorage.getItem("soundEnabled") === "1"){
  document.getElementById("soundOverlay").style.display = "none";
  soundEnabled = true;

  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  audioCtx.resume();

  fetch("https://assets.mixkit.co/sfx/preview/mixkit-warning-alarm-buzzer-991.mp3")
    .then(r => r.arrayBuffer())
    .then(b => audioCtx.decodeAudioData(b))
    .then(buf => alertBuffer = buf);
}

/* ===== TEST (remove later) ===== */
setTimeout(() => {
  console.log("Triggering test sound");
  playAlert();
}, 5000);
</script>

</body>
</html>
